---
- name: Check database connectivity
  postgresql_ping:
    db: "{{ database.name }}"
    login_host: "{{ database.host }}"
    login_user: "{{ database.user }}"
    login_password: "{{ database.password }}"
    port: "{{ database.port }}"
  register: result
  failed_when: not result.is_available
  until: result is succeeded
  retries: 10
  delay: 10

